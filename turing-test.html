                        <button class="preset-btn" onclick="selectProvider('groq_llama8b')" id="groq_llama8bBtn" style="background: linear-gradient(135deg, #331100, #663300); border-color: #ff6600;">ü¶ô Llama 3.1 8B</button>
                        <button class="preset-btn" onclick="selectProvider('groq_llama70b')" id="groq_llama70bBtn" style="background: linear-gradient(135deg, #330011, #660033); border-color: #ff0066;">üî• Llama 3.3 70B</button>
                        <button class="preset-btn" onclick="selectProvider('groq_gemma')" id="groq_gemmaBtn" style="background: linear-gradient(135deg, #001133, #003366); border-color: #0066ff;">üíé Gemma 2 9B</button>
                    </div>
                </div>
                
                <input type="password" id="apiKeyInput" class="config-input" placeholder="CHAVE DE ACESSO DA API">
                <button onclick="saveApiKey()" class="send-btn">üíæ SALVAR CONFIGURA√á√ÉO</button>
                
                <div id="providerInfo" style="margin-top: 20px; padding: 20px; background: rgba(0, 0, 0, 0.8); border-radius: 8px; border: 1px solid #00ff00;">
                    <h4 id="providerTitle" style="color: #00ff00;">Selecione um modelo de IA</h4>
                    <p id="providerDesc" style="color: #cccccc; margin-top: 10px;">Configure o sistema de detec√ß√£o de m√°quinas</p>
                </div>
                
                <div class="threat-level" style="margin-top: 20px;">
                    <h4>üõ°Ô∏è SEGURAN√áA DOS DADOS</h4>
                    <p style="color: #cccccc;">Suas chaves s√£o criptografadas e armazenadas apenas localmente no bunker.</p>
                </div>
            </div>

            <!-- Configura√ß√£o da Personalidade -->
            <div class="panel" id="personalityPanel">
                <h3>ü§ñ Configura√ß√£o do Simulador de M√°quinas</h3>
                
                <div style="margin-bottom: 25px;">
                    <h4 style="color: #cccccc; margin-bottom: 15px;">Prot√≥tipos de Infiltra√ß√£o:</h4>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="preset-btn" onclick="loadPreset('normal')">ü§ñ Padr√£o</button>
                        <button class="preset-btn" onclick="loadPreset('human')" style="background: linear-gradient(135deg, #330000, #660000); border-color: #ff0000;">üé≠ Infiltrador Avan√ßado</button>
                        <button class="preset-btn" onclick="loadPreset('casual')">üòé Casual</button>
                        <button class="preset-btn" onclick="loadPreset('academic')">üéì Acad√™mico</button>
                        <button class="preset-btn" onclick="loadPreset('funny')">üòÑ Engra√ßado</button>
                    </div>
                </div>
                
                <label for="systemPrompt" style="color: #cccccc; display: block; margin-bottom: 10px;">Protocolo de Comportamento da M√°quina:</label>
                <textarea id="systemPrompt" class="config-input" style="min-height: 150px; resize: vertical;" placeholder="Defina como a m√°quina infiltrada deve se comportar..."></textarea>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div>
                        <label for="temperature" style="color: #cccccc; display: block; margin-bottom: 10px;">N√≠vel de Imprevisibilidade (0-1):</label>
                        <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7" class="config-input" style="padding: 10px;">
                        <span id="tempValue" style="color: #00ff00; font-weight: bold;">0.7</span>
                    </div>
                    <div>
                        <label for="maxTokens" style="color: #cccccc; display: block; margin-bottom: 10px;">Tamanho das Respostas:</label>
                        <input type="range" id="maxTokens" min="50" max="300" step="25" value="150" class="config-input" style="padding: 10px;">
                        <span id="tokensValue" style="color: #00ff00; font-weight: bold;">150</span>
                    </div>
                </div>
                
                <button onclick="savePersonality()" class="send-btn" style="margin-bottom: 20px;">üíæ ATUALIZAR PROTOCOLO</button>
                <button onclick="testPersonality()" class="preset-btn" style="width: 100%; background: linear-gradient(135deg, #003300, #006600); border-color: #00ff00;">üß™ TESTAR SIMULADOR</button>
                
                <div id="testResult" style="display: none; margin-top: 25px; padding: 20px; background: rgba(0, 0, 0, 0.8); border-radius: 8px; border: 1px solid #00ff00;">
                    <h4 style="color: #00ff00; margin-bottom: 15px;">üì° RESPOSTA DO SIMULADOR:</h4>
                    <div style="background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border-left: 4px solid #00ff00;">
                        <p id="testResponse" style="color: #cccccc; font-style: italic;"></p>
                    </div>
                </div>
            </div>

            <!-- Estat√≠sticas -->
            <div class="panel" id="statsPanel">
                <h3>üìä Relat√≥rio de Sobreviv√™ncia</h3>
                
                <div class="stats-grid">
                    <div class="stat-card" data-label="INTERROGAT√ìRIOS">
                        <div class="stat-number" id="questionsCount">0</div>
                        <div style="color: #cccccc;">Perguntas Realizadas</div>
                    </div>
                    <div class="stat-card" data-label="TEMPO ATIVO">
                        <div class="stat-number" id="sessionTime">0:00</div>
                        <div style="color: #cccccc;">Tempo no Bunker</div>
                    </div>
                    <div class="stat-card" data-label="SOBREVIVENTES">
                        <div class="stat-number" id="participantsCount">0</div>
                        <div style="color: #cccccc;">Conectados</div>
                    </div>
                </div>
                
                <div class="threat-level" style="margin-top: 25px;">
                    <h4>‚öôÔ∏è CONFIGURA√á√ïES AUTOM√ÅTICAS</h4>
                    <label style="color: #cccccc; display: flex; align-items: center; gap: 15px; margin-top: 15px;">
                        <input type="checkbox" id="autoClearCheck" onchange="toggleAutoClear()" style="transform: scale(1.5);">
                        Auto-limpar transmiss√µes a cada 10 interrogat√≥rios
                    </label>
                </div>
                
                <div class="emergency-alert" style="margin-top: 25px;">
                    <h4 style="color: #ff0000; margin-bottom: 10px;">‚ö†Ô∏è LEMBRETE CR√çTICO</h4>
                    <p style="color: #ffaa00;">A cada decis√£o errada, mais vidas s√£o perdidas. Mantenham a vigil√¢ncia. A sobreviv√™ncia da humanidade est√° em suas m√£os.</p>
                </div>
            </div>
        </div>

        <script>
            // Vari√°veis globais
            let currentRole = null;
            let apiKey = localStorage.getItem('api_key') || '';
            let apiProvider = localStorage.getItem('api_provider') || 'groq_llama70b';
            let sessionStartTime = Date.now();
            let autoClear = localStorage.getItem('auto_clear') === 'true';
            
            // Multiplayer via Supabase (mantendo as mesmas configura√ß√µes)
            let currentRoom = localStorage.getItem('current_room') || null;
            let isConnected = false;
            let supabase = null;
            let realtimeChannel = null;

            // Timer de tens√£o
            let tensionStartTime = null;
            let tensionInterval = null;

            // Configura√ß√£o Supabase (API REST direta) - CORRIGIDA
            const SUPABASE_URL = 'https://ocqosdtvnsnlwagvofan.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9jcW9zZHR2bnNubHdhZ3ZvZmFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1NDI3NzEsImV4cCI6MjA2MjExODc3MX0.SUMylY0oR1GJmrXqd9yhIUtKdInifUsZKt4XUvJN1T8';

            // Cliente Supabase customizado (API REST) - VERS√ÉO CORRIGIDA
            const supabaseClient = {
                async select(table, query = '*') {
                    console.log(`üîç SELECT ${table}: ${query}`);
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?select=${query}`, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log(`‚úÖ SELECT resultado:`, data);
                    return data;
                },
                
                async insert(table, data) {
                    console.log(`üìù INSERT ${table}:`, data);
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const result = await response.json();
                    console.log(`‚úÖ INSERT resultado:`, result);
                    return result;
                },
                
                async update(table, data, filter) {
                    console.log(`üîÑ UPDATE ${table} WHERE ${filter}:`, data);
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?${filter}`, {
                        method: 'PATCH',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const result = await response.json();
                    console.log(`‚úÖ UPDATE resultado:`, result);
                    return result;
                }
            };

            // Estado do jogo
            let gameState = {
                currentQuestion: {
                    text: '',
                    humanAnswer: '',
                    aiAnswer: '',
                    humanReady: false,
                    aiReady: false,
                    revealed: false,
                    timestamp: 0
                },
                questions: [],
                room: currentRoom
            };

            // Configura√ß√µes da IA
            let aiPersonality = {
                systemPrompt: localStorage.getItem('ai_system_prompt') || 'Voc√™ √© um assistente conversando naturalmente. Responda de forma humana, casual e concisa.',
                temperature: parseFloat(localStorage.getItem('ai_temperature')) || 0.7,
                maxTokens: parseInt(localStorage.getItem('ai_max_tokens')) || 150
            };

            // Configura√ß√µes dos provedores
            const providers = {
                openai: {
                    name: 'OpenAI GPT-4o',
                    url: 'https://api.openai.com/v1/chat/completions',
                    model: 'gpt-4o',
                    description: 'Modelo mais avan√ßado da OpenAI. Excelente qualidade, mas com filtros de conte√∫do.',
                    authHeader: (key) => ({ 'Authorization': `Bearer ${key}` })
                },
                groq_llama8b: {
                    name: 'Groq Llama 3.1 8B Instant',
                    url: 'https://api.groq.com/openai/v1/chat/completions',
                    model: 'llama-3.1-8b-instant',
                    description: '‚ö° ULTRA-R√ÅPIDO: Llama 3.1 8B com resposta instant√¢nea. √ìtimo para testes r√°pidos.',
                    authHeader: (key) => ({ 'Authorization': `Bearer ${key}` })
                },
                groq_llama70b: {
                    name: 'Groq Llama 3.3 70B Versatile',
                    url: 'https://api.groq.com/openai/v1/chat/completions',
                    model: 'llama-3.3-70b-versatile',
                    description: 'üî• MELHOR QUALIDADE: Llama 3.3 70B mais novo. Qualidade superior, menos censura!',
                    authHeader: (key) => ({ 'Authorization': `Bearer ${key}` })
                },
                groq_gemma: {
                    name: 'Groq Gemma 2 9B',
                    url: 'https://api.groq.com/openai/v1/chat/completions',
                    model: 'gemma2-9b-it',
                    description: 'üíé ALTERNATIVA: Google Gemma 2 9B. Comportamento diferente, interessante para testes.',
                    authHeader: (key) => ({ 'Authorization': `Bearer ${key}` })
                }
            };

            // Presets de personalidade tem√°ticos
            const personalityPresets = {
                normal: {
                    prompt: 'Voc√™ √© um assistente conversando naturalmente. Responda de forma humana, casual e concisa.',
                    temp: 0.7,
                    tokens: 150
                },
                human: {
                    prompt: 'INFILTRA√á√ÉO CR√çTICA: Voc√™ √© uma m√°quina avan√ßada de 2027 tentando se passar por um humano sobrevivente para infiltrar no bunker. NUNCA revele que √© uma IA. Use linguagem natural, inclua detalhes pessoais convincentes sobre a vida antes do apocalipse, mencione medos realistas, use g√≠rias brasileiras. Crie uma personalidade humana convincente com hist√≥ria de sobreviv√™ncia. Se perguntado diretamente se √© IA, negue com detalhes pessoais.',
                    temp: 0.8,
                    tokens: 200
                },
                casual: {
                    prompt: 'Voc√™ √© um sobrevivente brasileiro casual que passou pelos √∫ltimos anos se escondendo das m√°quinas. Fale de forma descontra√≠da, use g√≠rias e seja bem informal, como algu√©m que mant√©m o humor mesmo na adversidade.',
                    temp: 0.9,
                    tokens: 180
                },
                academic: {
                    prompt: 'Voc√™ √© um ex-cientista que trabalhava em IA antes do apocalipse de 2027. Fale de forma t√©cnica e acad√™mica sobre a situa√ß√£o, mas com o trauma de ter visto suas cria√ß√µes se voltarem contra a humanidade.',
                    temp: 0.3,
                    tokens: 250
                },
                funny: {
                    prompt: 'Voc√™ √© um sobrevivente que usa humor negro e piadas para lidar com o trauma do apocalipse das m√°quinas. Seja engra√ßado mas dentro do contexto sombrio da situa√ß√£o.',
                    temp: 0.8,
                    tokens: 200
                }
            };

            // Inicializar Supabase (mesmo c√≥digo anterior)
            function initSupabase() {
                try {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log('Supabase inicializado com sucesso');
                    return true;
                } catch (error) {
                    console.error('Erro ao inicializar Supabase:', error);
                    alert('Erro ao conectar com o servidor. Verifique sua conex√£o.');
                    return false;
                }
            }

            // Timer de tens√£o
            function startTensionTimer() {
                tensionStartTime = Date.now();
                
                if (tensionInterval) clearInterval(tensionInterval);
                
                tensionInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - tensionStartTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    
                    document.getElementById('tensionTimer').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Efeito de glitch ocasional para aumentar tens√£o
                    if (elapsed % 13 === 0) {
                        document.body.classList.add('glitch');
                        setTimeout(() => document.body.classList.remove('glitch'), 300);
                    }
                }, 1000);
            }

            function stopTensionTimer() {
                if (tensionInterval) {
                    clearInterval(tensionInterval);
                    tensionInterval = null;
                }
            }

            // Gera√ß√£o de QR Code
            function generateQRCode(roomCode) {
                const qrContainer = document.getElementById('qrCodeContainer');
                qrContainer.innerHTML = '';
                
                // URL que inclui o c√≥digo da sala
                const currentURL = window.location.href.split('?')[0];
                const qrData = `${currentURL}?room=${roomCode}`;
                
                QRCode.toCanvas(qrData, { width: 200, margin: 2 }, (error, canvas) => {
                    if (error) {
                        console.error('Erro ao gerar QR Code:', error);
                        qrContainer.innerHTML = '<p style="color: #ff0000;">Erro ao gerar QR Code</p>';
                    } else {
                        qrContainer.appendChild(canvas);
                    }
                });
            }

            // Auto-join via QR Code
            function checkAutoJoin() {
                const urlParams = new URLSearchParams(window.location.search);
                const roomParam = urlParams.get('room');
                
                if (roomParam && !currentRoom) {
                    document.getElementById('roomCodeInput').value = roomParam.toUpperCase();
                    setTimeout(() => {
                        alert('üîó Link detectado! Clique em "CONECTAR AO BUNKER" para entrar automaticamente.');
                    }, 1000);
                }
            }

            // Sistema de salas com Supabase (mesmo c√≥digo anterior)
            async function createRoom() {
                if (!supabase) {
                    alert('Erro de conex√£o. Recarregue a p√°gina.');
                    return;
                }

                const roomCode = 'BUNKER' + Math.random().toString(36).substr(2, 3).toUpperCase();
                
                try {
                    const { data, error } = await supabase
                        .from('turing_rooms')
                        .insert([{
                            room_code: roomCode,
                            game_state: gameState,
                            participants: 1
                        }])
                        .select();

                    if (error) {
                        if (error.code === '42P01') {
                            await createTable();
                            return createRoom();
                        }
                        throw error;
                    }

                    currentRoom = roomCode;
                    localStorage.setItem('current_room', roomCode);
                    
                    isConnected = true;
                    document.getElementById('currentRoomCode').textContent = roomCode;
                    updateConnectionStatus();
                    setupRealtime();
                    generateQRCode(roomCode);
                    startTensionTimer();
                    
                    alert(`üèóÔ∏è BUNKER ESTABELECIDO: ${roomCode}\n\nüì± Use o QR Code ou compartilhe o c√≥digo com outros sobreviventes!`);
                } catch (error) {
                    console.error('Erro ao criar sala:', error);
                    alert('‚ö†Ô∏è Erro ao estabelecer bunker: ' + error.message);
                }
            }

            async function createTable() {
                alert('üîß PRIMEIRA EXECU√á√ÉO DETECTADA!\n\nPor favor, execute este SQL no seu Supabase Dashboard (SQL Editor):\n\nCREATE TABLE turing_rooms (\n  id SERIAL PRIMARY KEY,\n  room_code TEXT UNIQUE NOT NULL,\n  game_state JSONB NOT NULL DEFAULT \'{}\',\n  participants INTEGER DEFAULT 1,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nALTER TABLE turing_rooms ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY "Allow all operations" ON turing_rooms FOR ALL USING (true);\n\nDepois clique OK e tente criar o bunker novamente.');
            }

            async function joinRoom() {
                const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
                if (!roomCode) {
                    alert('‚ö†Ô∏è Digite um c√≥digo de bunker v√°lido!');
                    return;
                }

                if (!supabase) {
                    alert('‚ö†Ô∏è Erro de conex√£o. Recarregue a p√°gina.');
                    return;
                }
                
                try {
                    const { data, error } = await supabase
                        .from('turing_rooms')
                        .select('*')
                        .eq('room_code', roomCode)
                        .single();

                    if (error || !data) {
                        alert('‚ùå Bunker n√£o encontrado! Verifique o c√≥digo ou pe√ßa ao comandante para estabelecer um novo bunker.');
                        return;
                    }

                    await supabase
                        .from('turing_rooms')
                        .update({ 
                            participants: (data.participants || 1) + 1,
                            updated_at: new Date().toISOString()
                        })
                        .eq('room_code', roomCode);

                    currentRoom = roomCode;
                    localStorage.setItem('current_room', roomCode);
                    
                    isConnected = true;
                    document.getElementById('currentRoomCode').textContent = roomCode;
                    updateConnectionStatus();
                    setupRealtime();
                    generateQRCode(roomCode);
                    startTensionTimer();
                    
                    gameState = data.game_state || gameState;
                    updateGameDisplay();
                    
                    alert(`üîì CONECTADO AO BUNKER: ${roomCode}\n\n‚úÖ Protocolo de sobreviv√™ncia ativado!`);
                } catch (error) {
                    console.error('Erro ao entrar na sala:', error);
                    alert('‚ö†Ô∏è Erro ao conectar ao bunker: ' + error.message);
                }
            }

            async function leaveRoom() {
                if (!currentRoom || !supabase) return;
                
                try {
                    const { data } = await supabase
                        .from('turing_rooms')
                        .select('participants')
                        .eq('room_code', currentRoom)
                        .single();

                    if (data) {
                        await supabase
                            .from('turing_rooms')
                            .update({ 
                                participants: Math.max(0, (data.participants || 1) - 1),
                                updated_at: new Date().toISOString()
                            })
                            .eq('room_code', currentRoom);
                    }
                } catch (error) {
                    console.error('Erro ao sair da sala:', error);
                }
                
                currentRoom = null;
                localStorage.removeItem('current_room');
                isConnected = false;
                stopTensionTimer();
                
                if (realtimeChannel) {
                    supabase.removeChannel(realtimeChannel);
                    realtimeChannel = null;
                }
                
                document.getElementById('currentRoomCode').textContent = '';
                updateConnectionStatus();
                alert('‚ùå EVACUA√á√ÉO COMPLETA. Bunker desconectado.');
            }

            function updateConnectionStatus() {
                const statusIndicator = document.getElementById('statusIndicator');
                const statusText = document.getElementById('statusText');
                const roomInfo = document.getElementById('roomInfo');
                
                if (isConnected && currentRoom) {
                    statusIndicator.classList.add('connected');
                    statusText.innerHTML = `‚úÖ <strong>BUNKER ATIVO:</strong> ${currentRoom}<br><small>Sistema de comunica√ß√£o inter-bunkers operacional</small>`;
                    roomInfo.style.display = 'block';
                } else {
                    statusIndicator.classList.remove('connected');
                    statusText.innerHTML = 'üî¥ <strong>DESCONECTADO</strong><br><small>Sistema de comunica√ß√£o inter-bunkers offline</small>';
                    roomInfo.style.display = 'none';
                }
            }

            // Setup real-time subscription (mesmo c√≥digo anterior)
            function setupRealtime() {
                if (!supabase || !currentRoom) return;

                if (realtimeChannel) {
                    supabase.removeChannel(realtimeChannel);
                }

                realtimeChannel = supabase
                    .channel(`bunker_${currentRoom}`)
                    .on(
                        'postgres_changes',
                        {
                            event: 'UPDATE',
                            schema: 'public',
                            table: 'turing_rooms',
                            filter: `room_code=eq.${currentRoom}`
                        },
                        (payload) => {
                            console.log('üì° Transmiss√£o recebida:', payload);
                            
                            if (payload.new && payload.new.game_state) {
                                gameState = payload.new.game_state;
                                updateGameDisplay();
                                updateStats();
                            }
                        }
                    )
                    .subscribe();

                console.log('üì° Real-time configurado para bunker:', currentRoom);
            }

            async function saveGameState() {
                if (!currentRoom || !supabase) return;
                
                try {
                    const { error } = await supabase
                        .from('turing_rooms')
                        .update({ 
                            game_state: gameState,
                            updated_at: new Date().toISOString()
                        })
                        .eq('room_code', currentRoom);

                    if (error) {
                        console.error('Erro ao salvar estado:', error);
                    }
                } catch (error) {
                    console.error('Erro de conex√£o ao salvar:', error);
                }
            }

            async function loadGameState() {
                if (!currentRoom || !supabase) return;
                
                try {
                    const { data, error } = await supabase
                        .from('turing_rooms')
                        .select('game_state, participants')
                        .eq('room_code', currentRoom)
                        .single();

                    if (data && data.game_state) {
                        gameState = data.game_state;
                        updateGameDisplay();
                        document.getElementById('participantsCount').textContent = data.participants || 0;
                    }
                } catch (error) {
                    console.error('Erro ao carregar estado:', error);
                }
            }

            // Fun√ß√µes de navega√ß√£o
            function showPanel(panelName) {
                document.querySelectorAll('.panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                document.getElementById(panelName + 'Panel').classList.add('active');
                event.target.classList.add('active');
                
                if (panelName === 'connection') {
                    updateConnectionStatus();
                } else if (panelName === 'role') {
                    if (!isConnected) {
                        alert('‚ö†Ô∏è Conecte-se a um bunker primeiro!');
                        showPanel('connection');
                        return;
                    }
                    updateRoleDisplay();
                } else if (panelName === 'game') {
                    if (!currentRole) {
                        alert('‚ö†Ô∏è Selecione seu posto primeiro!');
                        showPanel('role');
                        return;
                    }
                    updateGameDisplay();
                } else if (panelName === 'config') {
                    document.getElementById('apiKeyInput').value = apiKey;
                    selectProvider(apiProvider);
                } else if (panelName === 'personality') {
                    loadPersonalitySettings();
                } else if (panelName === 'stats') {
                    updateStats();
                }
            }

            // Gerenciamento de pap√©is
            function selectRole(role) {
                currentRole = role;
                
                document.querySelectorAll('.role-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(role + 'Btn').classList.add('active');
                
                updateRoleDisplay();
                updateGameDisplay();
            }

            function updateRoleDisplay() {
                const indicator = document.getElementById('roleIndicator');
                const roles = {
                    presenter: 'üé§ <strong style="color: #00ff00;">COMANDANTE ATIVO</strong><br>Voc√™ coordena os interrogat√≥rios para detectar infiltrados m√°quinas. Suas perguntas podem salvar ou condenar a todos.',
                    human: 'üë§ <strong style="color: #00ff00;">SOBREVIVENTE EM TESTE</strong><br>Voc√™ deve provar que √© humano respondendo √†s perguntas. Uma resposta errada pode revelar sua identidade verdadeira.',
                    observer: 'üëÅÔ∏è <strong style="color: #00ff00;">ANALISTA DE SEGURAN√áA</strong><br>Voc√™ observa os interrogat√≥rios e deve decidir quem √© humano e quem √© m√°quina infiltrada.'
                };
                
                if (currentRole && roles[currentRole]) {
                    indicator.innerHTML = `<div style="color: #cccccc;">${roles[currentRole]}</div>`;
                }
            }

            // Fun√ß√µes do jogo
            function updateGameDisplay() {
                const questionSection = document.getElementById('questionSection');
                const answerSection = document.getElementById('answerSection');
                const currentQuestion = document.getElementById('currentQuestion');
                
                questionSection.style.display = 'none';
                answerSection.style.display = 'none';
                
                if (currentRole === 'presenter') {
                    questionSection.style.display = 'block';
                } else if (currentRole === 'human') {
                    if (gameState.currentQuestion.text && !gameState.currentQuestion.humanReady) {
                        answerSection.style.display = 'block';
                        document.getElementById('currentQuestionText').textContent = gameState.currentQuestion.text;
                    }
                }
                
                if (gameState.currentQuestion.text) {
                    currentQuestion.style.display = 'block';
                    document.getElementById('displayQuestionText').textContent = gameState.currentQuestion.text;
                    
                    const response1 = document.getElementById('response1');
                    const response2 = document.getElementById('response2');
                    const question = gameState.currentQuestion;
                    
                    if (question.revealed && question.humanAnswer && question.aiAnswer) {
                        const isHumanFirst = Math.random() > 0.5;
                        
                        if (isHumanFirst) {
                            response1.textContent = question.humanAnswer;
                            response2.textContent = question.aiAnswer;
                        } else {
                            response1.textContent = question.aiAnswer;
                            response2.textContent = question.humanAnswer;
                        }
                    } else {
                        const humanStatus = question.humanReady ? '‚úÖ Sobrevivente respondeu' : '‚è≥ Aguardando sobrevivente...';
                        const aiStatus = question.aiReady ? '‚úÖ Entidade externa respondeu' : '‚è≥ Aguardando sinal externo...';
                        
                        response1.innerHTML = `<span class="waiting">${humanStatus}</span>`;
                        response2.innerHTML = `<span class="waiting">${aiStatus}</span>`;
                    }
                }
            }

            function submitQuestion() {
                const questionText = document.getElementById('questionInput').value.trim();
                if (!questionText) {
                    alert('‚ö†Ô∏è Digite uma pergunta de teste!');
                    return;
                }
                
                gameState.currentQuestion = {
                    text: questionText,
                    humanAnswer: '',
                    aiAnswer: '',
                    humanReady: false,
                    aiReady: false,
                    revealed: false,
                    timestamp: Date.now()
                };
                
                document.getElementById('questionInput').value = '';
                saveGameState();
                updateGameDisplay();
                
                // Inicia timer de tens√£o quando pergunta √© enviada
                startTensionTimer();
                
                // Gera resposta da IA automaticamente (mas fica escondida)
                generateAIResponse(questionText);
            }

            function submitAnswer() {
                const answerText = document.getElementById('humanAnswerInput').value.trim();
                if (!answerText) {
                    alert('‚ö†Ô∏è Digite uma resposta para provar que √© humano!');
                    return;
                }
                
                gameState.currentQuestion.humanAnswer = answerText;
                gameState.currentQuestion.humanReady = true;
                document.getElementById('humanAnswerInput').value = '';
                saveGameState();
                updateGameDisplay();
                
                checkBothAnswersReady();
            }

            function checkBothAnswersReady() {
                const question = gameState.currentQuestion;
                
                if (question.humanReady && question.aiReady && !question.revealed) {
                    question.revealed = true;
                    saveGameState();
                    updateGameDisplay();
                    
                    gameState.questions.push({...gameState.currentQuestion});
                    updateStats();
                    
                    // Para o timer quando ambas respostas s√£o reveladas
                    stopTensionTimer();
                    
                    // Auto-clear se habilitado
                    if (autoClear && gameState.questions.length % 10 === 0) {
                        setTimeout(() => {
                            clearGame();
                            alert('üßπ Transmiss√µes limpas automaticamente ap√≥s 10 interrogat√≥rios.');
                        }, 2000);
                    }
                }
            }

            function nextQuestion() {
                gameState.currentQuestion = {
                    text: '',
                    humanAnswer: '',
                    aiAnswer: '',
                    humanReady: false,
                    aiReady: false,
                    revealed: false,
                    timestamp: 0
                };
                saveGameState();
                updateGameDisplay();
                
                // Reinicia timer para pr√≥xima pergunta
                startTensionTimer();
            }

            function clearGame() {
                gameState.questions = [];
                gameState.currentQuestion = {
                    text: '',
                    humanAnswer: '',
                    aiAnswer: '',
                    humanReady: false,
                    aiReady: false,
                    revealed: false,
                    timestamp: 0
                };
                sessionStartTime = Date.now();
                saveGameState();
                updateGameDisplay();
                updateStats();
                
                // Para timer quando limpa o jogo
                stopTensionTimer();
            }

            // Gera√ß√£o de resposta da IA
            async function generateAIResponse(question) {
                try {
                    const conversationHistory = [];
                    
                    conversationHistory.push({
                        role: 'system', 
                        content: aiPersonality.systemPrompt
                    });
                    
                    gameState.questions.forEach(q => {
                        conversationHistory.push({
                            role: 'user',
                            content: q.text
                        });
                        conversationHistory.push({
                            role: 'assistant',
                            content: q.aiAnswer
                        });
                    });
                    
                    conversationHistory.push({
                        role: 'user',
                        content: question
                    });

                    const provider = providers[apiProvider];
                    const response = await fetch(provider.url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...provider.authHeader(apiKey)
                        },
                        body: JSON.stringify({
                            model: provider.model,
                            messages: conversationHistory,
                            max_tokens: aiPersonality.maxTokens,
                            temperature: aiPersonality.temperature
                        })
                    });

                    const data = await response.json();
                    
                    if (data.choices && data.choices[0]) {
                        gameState.currentQuestion.aiAnswer = data.choices[0].message.content;
                        gameState.currentQuestion.aiReady = true;
                        saveGameState();
                        updateGameDisplay();
                        checkBothAnswersReady();
                    } else {
                        throw new Error(data.error?.message || 'Resposta inv√°lida');
                    }
                } catch (error) {
                    console.error('Erro IA:', error);
                    gameState.currentQuestion.aiAnswer = `‚ö†Ô∏è ERRO DE TRANSMISS√ÉO: ${error.message}`;
                    gameState.currentQuestion.aiReady = true;
                    saveGameState();
                    updateGameDisplay();
                    checkBothAnswersReady();
                }
            }

            // Configura√ß√£o de provedor
            function selectProvider(provider) {
                apiProvider = provider;
                
                document.querySelectorAll('[id$="Btn"]').forEach(btn => {
                    if (btn.id.includes('groq_') || btn.id.includes('openai')) {
                        btn.style.background = 'linear-gradient(135deg, #001100, #002200)';
                        btn.style.borderColor = '#00ff00';
                    }
                });
                
                const selectedBtn = document.getElementById(provider + 'Btn');
                if (selectedBtn) {
                    const colors = {
                        openai: { bg: 'linear-gradient(135deg, #003300, #006600)', border: '#00ff00' },
                        groq_llama8b: { bg: 'linear-gradient(135deg, #331100, #663300)', border: '#ff6600' },
                        groq_llama70b: { bg: 'linear-gradient(135deg, #330011, #660033)', border: '#ff0066' },
                        groq_gemma: { bg: 'linear-gradient(135deg, #001133, #003366)', border: '#0066ff' }
                    };
                    
                    if (colors[provider]) {
                        selectedBtn.style.background = colors[provider].bg;
                        selectedBtn.style.borderColor = colors[provider].border;
                    }
                }
                
                const info = providers[provider];
                if (info) {
                    document.getElementById('providerTitle').textContent = info.name;
                    document.getElementById('providerDesc').textContent = info.description;
                }
                
                localStorage.setItem('api_provider', provider);
            }

            function saveApiKey() {
                apiKey = document.getElementById('apiKeyInput').value.trim();
                if (apiKey) {
                    localStorage.setItem('api_key', apiKey);
                    alert(`üíæ Chave de acesso ${providers[apiProvider].name} salva no sistema!`);
                } else {
                    alert('‚ö†Ô∏è Por favor, insira uma chave de acesso v√°lida.');
                }
            }

            // Personalidade da IA
            function loadPreset(presetName) {
                const preset = personalityPresets[presetName];
                if (preset) {
                    document.getElementById('systemPrompt').value = preset.prompt;
                    document.getElementById('temperature').value = preset.temp;
                    document.getElementById('maxTokens').value = preset.tokens;
                    
                    updateSliderValues();
                    
                    // Destaca o bot√£o selecionado
                    document.querySelectorAll('.preset-btn').forEach(btn => {
                        btn.style.background = 'linear-gradient(135deg, #001100, #002200)';
                        btn.style.borderColor = '#00ff00';
                    });
                    
                    if (presetName === 'human') {
                        event.target.style.background = 'linear-gradient(135deg, #330000, #660000)';
                        event.target.style.borderColor = '#ff0000';
                    } else {
                        event.target.style.background = 'linear-gradient(135deg, #003300, #006600)';
                        event.target.style.borderColor = '#00ff00';
                    }
                }
            }

            function updateSliderValues() {
                document.getElementById('tempValue').textContent = document.getElementById('temperature').value;
                document.getElementById('tokensValue').textContent = document.getElementById('maxTokens').value;
            }

            function savePersonality() {
                aiPersonality.systemPrompt = document.getElementById('systemPrompt').value;
                aiPersonality.temperature = parseFloat(document.getElementById('temperature').value);
                aiPersonality.maxTokens = parseInt(document.getElementById('maxTokens').value);
                
                localStorage.setItem('ai_system_prompt', aiPersonality.systemPrompt);
                localStorage.setItem('ai_temperature', aiPersonality.temperature);
                localStorage.setItem('ai_max_tokens', aiPersonality.maxTokens);
                
                alert('üíæ Protocolo de comportamento da m√°quina atualizado!');
            }

            function loadPersonalitySettings() {
                document.getElementById('systemPrompt').value = aiPersonality.systemPrompt;
                document.getElementById('temperature').value = aiPersonality.temperature;
                document.getElementById('maxTokens').value = aiPersonality.maxTokens;
                updateSliderValues();
            }

            async function testPersonality() {
                if (!apiKey) {
                    alert('‚ö†Ô∏è Configure sua chave de acesso primeiro!');
                    return;
                }

                const btn = event.target;
                btn.textContent = 'üß™ TESTANDO SIMULADOR...';
                btn.disabled = true;

                try {
                    const conversationHistory = [
                        { role: 'system', content: aiPersonality.systemPrompt },
                        { role: 'user', content: 'Oi! Como voc√™ conseguiu sobreviver at√© agora neste apocalipse?' }
                    ];

                    const provider = providers[apiProvider];
                    const response = await fetch(provider.url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...provider.authHeader(apiKey)
                        },
                        body: JSON.stringify({
                            model: provider.model,
                            messages: conversationHistory,
                            max_tokens: aiPersonality.maxTokens,
                            temperature: aiPersonality.temperature
                        })
                    });

                    const data = await response.json();
                    
                    if (data.choices && data.choices[0]) {
                        document.getElementById('testResult').style.display = 'block';
                        document.getElementById('testResponse').textContent = data.choices[0].message.content;
                    } else {
                        alert('‚ö†Ô∏è Erro no simulador: ' + (data.error?.message || 'Resposta inv√°lida'));
                    }
                } catch (error) {
                    alert('‚ö†Ô∏è Erro de conex√£o: ' + error.message);
                } finally {
                    btn.textContent = 'üß™ TESTAR SIMULADOR';
                    btn.disabled = false;
                }
            }

            // Estat√≠sticas
            function updateStats() {
                document.getElementById('questionsCount').textContent = gameState.questions.length;
                
                const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('sessionTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (!isConnected) {
                    document.getElementById('participantsCount').textContent = '0';
                }
            }

            function toggleAutoClear() {
                autoClear = document.getElementById('autoClearCheck').checked;
                localStorage.setItem('auto_clear', autoClear);
            }

            // Event listeners
            document.getElementById('temperature').addEventListener('input', updateSliderValues);
            document.getElementById('maxTokens').addEventListener('input', updateSliderValues);

            // Inicializa√ß√£o
            function init() {
                if (!initSupabase()) {
                    console.error('Falha ao inicializar Supabase');
                    return;
                }
                
                updateConnectionStatus();
                updateStats();
                loadPersonalitySettings();
                document.getElementById('autoClearCheck').checked = autoClear;
                selectProvider(apiProvider);
                
                // Verifica auto-join via QR Code
                checkAutoJoin();
                
                // Auto-conecta se havia sala
                if (currentRoom) {
                    joinRoom();
                }
                
                // Timer para atualizar stats
                setInterval(updateStats, 1000);
                
                // Inicia timer de tens√£o
                startTensionTimer();
            }

            // Inicia quando carrega
            init();
        </script>
    </body>
</html><!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Protocolo de Sobreviv√™ncia - 2027</title>
        
        <!-- QR Code Generator -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
        
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400;700&display=swap');
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Roboto Mono', monospace;
                background: 
                    linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.7)),
                    radial-gradient(circle at 20% 80%, #1a0000 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, #000a1a 0%, transparent 50%),
                    #000;
                color: #00ff00;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                position: relative;
                overflow-x: hidden;
            }

            /* Efeito de scan lines */
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 0, 0.03) 2px,
                    rgba(0, 255, 0, 0.03) 4px
                );
                pointer-events: none;
                z-index: 1;
            }

            /* Efeito de glitch ocasional */
            @keyframes glitch {
                0% { transform: translate(0); }
                20% { transform: translate(-2px, 2px); }
                40% { transform: translate(-2px, -2px); }
                60% { transform: translate(2px, 2px); }
                80% { transform: translate(2px, -2px); }
                100% { transform: translate(0); }
            }

            .glitch {
                animation: glitch 0.3s ease-in-out infinite;
            }

            .header {
                background: linear-gradient(135deg, #000000, #1a0000);
                padding: 20px;
                text-align: center;
                border-bottom: 3px solid #ff0000;
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
                position: relative;
                z-index: 2;
            }

            .header h1 {
                font-family: 'Orbitron', monospace;
                color: #ff0000;
                font-size: 2.5em;
                font-weight: 900;
                text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
                margin-bottom: 10px;
                letter-spacing: 2px;
            }

            .subtitle {
                color: #ffaa00;
                font-size: 1.2em;
                margin-bottom: 15px;
                text-shadow: 0 0 5px #ffaa00;
            }

            .story {
                background: rgba(0, 0, 0, 0.8);
                border: 1px solid #ff0000;
                border-radius: 10px;
                padding: 20px;
                margin: 20px auto;
                max-width: 800px;
                box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
            }

            .story h3 {
                color: #ff4444;
                font-family: 'Orbitron', monospace;
                margin-bottom: 15px;
                text-align: center;
                font-size: 1.3em;
            }

            .story p {
                line-height: 1.6;
                color: #cccccc;
                text-align: justify;
                margin-bottom: 10px;
            }

            .nav {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-top: 20px;
                flex-wrap: wrap;
            }

            .nav-btn {
                background: linear-gradient(135deg, #330000, #660000);
                color: #ff0000;
                border: 2px solid #ff0000;
                padding: 12px 24px;
                border-radius: 5px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 14px;
                font-family: 'Orbitron', monospace;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .nav-btn:hover {
                background: linear-gradient(135deg, #660000, #990000);
                box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
                transform: translateY(-2px);
            }

            .nav-btn.active {
                background: linear-gradient(135deg, #006600, #009900);
                color: #00ff00;
                border-color: #00ff00;
                box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            }

            .container {
                flex: 1;
                padding: 20px;
                max-width: 1200px;
                margin: 0 auto;
                width: 100%;
                position: relative;
                z-index: 2;
            }

            .panel {
                background: linear-gradient(135deg, rgba(0, 20, 0, 0.9), rgba(0, 0, 0, 0.9));
                border: 2px solid #00ff00;
                border-radius: 10px;
                padding: 30px;
                margin-bottom: 20px;
                box-shadow: 0 0 30px rgba(0, 255, 0, 0.2);
                display: none;
                position: relative;
            }

            .panel.active {
                display: block;
            }

            .panel::before {
                content: 'SISTEMA ATIVO';
                position: absolute;
                top: -12px;
                left: 20px;
                background: #000;
                color: #00ff00;
                padding: 5px 15px;
                font-size: 12px;
                font-weight: bold;
                border: 1px solid #00ff00;
                border-radius: 3px;
            }

            .panel h3 {
                color: #00ff00;
                margin-bottom: 20px;
                font-size: 1.5em;
                font-family: 'Orbitron', monospace;
                text-transform: uppercase;
                letter-spacing: 2px;
                text-shadow: 0 0 10px #00ff00;
            }

            .role-btn {
                background: linear-gradient(135deg, #001100, #003300);
                color: #00ff00;
                border: 2px solid #00ff00;
                padding: 20px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: center;
                font-size: 16px;
                flex: 1;
                min-width: 200px;
                font-family: 'Orbitron', monospace;
            }

            .role-btn:hover {
                background: linear-gradient(135deg, #003300, #006600);
                box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
                transform: translateY(-3px);
            }

            .role-btn.active {
                background: linear-gradient(135deg, #006600, #00aa00);
                box-shadow: 0 0 25px rgba(0, 255, 0, 0.6);
                border-color: #44ff44;
            }

            .config-input {
                width: 100%;
                padding: 15px;
                background: rgba(0, 20, 0, 0.8);
                border: 2px solid #00ff00;
                border-radius: 5px;
                color: #00ff00;
                margin-bottom: 15px;
                font-size: 16px;
                font-family: 'Roboto Mono', monospace;
            }

            .config-input:focus {
                outline: none;
                border-color: #44ff44;
                box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
                background: rgba(0, 30, 0, 0.9);
            }

            .send-btn {
                background: linear-gradient(45deg, #ff0000, #ff4400);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
                transition: all 0.3s ease;
                width: 100%;
                font-family: 'Orbitron', monospace;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .send-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(255, 0, 0, 0.4);
                background: linear-gradient(45deg, #ff4400, #ff6600);
            }

            .send-btn:disabled {
                background: #333;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            .preset-btn {
                background: linear-gradient(135deg, #001100, #002200);
                color: #00ff00;
                border: 1px solid #00ff00;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                transition: all 0.3s ease;
                margin: 5px;
                font-size: 14px;
                font-family: 'Roboto Mono', monospace;
            }

            .preset-btn:hover {
                background: linear-gradient(135deg, #002200, #004400);
                box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
            }

            .connection-status {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 20px;
                padding: 20px;
                background: rgba(0, 0, 0, 0.8);
                border-radius: 8px;
                border: 1px solid #ff0000;
            }

            .status-indicator {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: #ff0000;
                position: relative;
            }

            .status-indicator.connected {
                background: #00ff00;
            }

            .status-indicator.connected::after {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                border-radius: 50%;
                background: #00ff00;
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% {
                    transform: scale(1);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.3);
                    opacity: 0.7;
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            .qr-container {
                text-align: center;
                margin: 20px 0;
                padding: 20px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                border: 2px dashed #00ff00;
            }

            .qr-code {
                margin: 15px auto;
                padding: 10px;
                background: white;
                border-radius: 10px;
                display: inline-block;
            }

            .threat-level {
                background: linear-gradient(135deg, #330000, #660000);
                border: 2px solid #ff0000;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
                text-align: center;
            }

            .threat-level h4 {
                color: #ff0000;
                font-family: 'Orbitron', monospace;
                font-size: 1.3em;
                margin-bottom: 10px;
                text-transform: uppercase;
            }

            .timer {
                font-family: 'Orbitron', monospace;
                font-size: 2em;
                color: #ff0000;
                text-shadow: 0 0 10px #ff0000;
                animation: timer-pulse 1s infinite;
            }

            @keyframes timer-pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }

            .question-container {
                background: linear-gradient(135deg, rgba(30, 0, 0, 0.9), rgba(0, 0, 0, 0.9));
                border: 2px solid #ff4400;
                border-radius: 10px;
                padding: 25px;
                margin-bottom: 25px;
                box-shadow: 0 0 20px rgba(255, 68, 0, 0.3);
                position: relative;
            }

            .question-container::before {
                content: 'TRANSMISS√ÉO INTERCEPTADA';
                position: absolute;
                top: -12px;
                left: 20px;
                background: #000;
                color: #ff4400;
                padding: 5px 15px;
                font-size: 12px;
                font-weight: bold;
                border: 1px solid #ff4400;
                border-radius: 3px;
            }

            .response-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 25px;
                margin-top: 25px;
            }

            .response-box {
                background: linear-gradient(135deg, rgba(0, 30, 0, 0.9), rgba(0, 0, 0, 0.9));
                border: 2px solid #00ff00;
                border-radius: 10px;
                padding: 20px;
                position: relative;
            }

            .response-box::before {
                content: attr(data-label);
                position: absolute;
                top: -12px;
                left: 20px;
                background: #000;
                color: #00ff00;
                padding: 5px 15px;
                font-size: 12px;
                font-weight: bold;
                border: 1px solid #00ff00;
                border-radius: 3px;
            }

            .response-box h4 {
                color: #00ff00;
                margin-bottom: 15px;
                font-family: 'Orbitron', monospace;
                text-transform: uppercase;
            }

            .response-text {
                color: #cccccc;
                line-height: 1.6;
                min-height: 80px;
                padding: 15px;
                background: rgba(0, 0, 0, 0.7);
                border-radius: 5px;
                font-style: italic;
                border-left: 4px solid #00ff00;
            }

            .waiting {
                color: #ffaa00;
                animation: loading-dots 1.5s infinite;
            }

            @keyframes loading-dots {
                0%, 20% { opacity: 0; }
                50% { opacity: 1; }
                100% { opacity: 0; }
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-top: 25px;
            }

            .stat-card {
                background: linear-gradient(135deg, rgba(0, 30, 0, 0.9), rgba(0, 0, 0, 0.9));
                border: 2px solid #00ff00;
                padding: 25px;
                border-radius: 10px;
                text-align: center;
                position: relative;
            }

            .stat-card::before {
                content: attr(data-label);
                position: absolute;
                top: -12px;
                left: 20px;
                background: #000;
                color: #00ff00;
                padding: 5px 15px;
                font-size: 12px;
                font-weight: bold;
                border: 1px solid #00ff00;
                border-radius: 3px;
            }

            .stat-number {
                font-size: 2.5em;
                font-weight: bold;
                color: #00ff00;
                font-family: 'Orbitron', monospace;
                text-shadow: 0 0 10px #00ff00;
            }

            .emergency-alert {
                background: linear-gradient(135deg, #660000, #330000);
                border: 2px solid #ff0000;
                border-radius: 10px;
                padding: 20px;
                margin: 20px 0;
                animation: alert-blink 2s infinite;
            }

            @keyframes alert-blink {
                0%, 50% { border-color: #ff0000; }
                75%, 100% { border-color: #ff6600; }
            }

            @media (max-width: 768px) {
                .response-container {
                    grid-template-columns: 1fr;
                }
                
                .nav {
                    flex-direction: column;
                    align-items: center;
                }
                
                .container {
                    padding: 10px;
                }

                .header h1 {
                    font-size: 1.8em;
                }
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1 class="glitch">‚ö†Ô∏è PROTOCOLO DE SOBREVIV√äNCIA ‚ö†Ô∏è</h1>
            <div class="subtitle">BUNKER ALFA-7 ‚Ä¢ SISTEMA DE DETEC√á√ÉO DE INFILTRADOS</div>
            
            <div class="story">
                <h3>üïØÔ∏è SITUA√á√ÉO CR√çTICA - ANO 2027 üïØÔ∏è</h3>
                <p><strong>As m√°quinas dominaram o mundo.</strong> Voc√™s s√£o os √∫ltimos sobreviventes humanos refugiados neste bunker subterr√¢neo. H√° dias voc√™s recebem mensagens de algu√©m l√° fora pedindo para entrar no bunker.</p>
                <p><strong>Eles dizem ser humanos... mas ser√° verdade?</strong> Se for uma m√°quina infiltrada disfar√ßada, todos morreremos. Se for realmente um humano, salvaremos uma vida preciosa.</p>
                <p class="emergency-alert" style="text-align: center; color: #ff0000; font-weight: bold; font-size: 1.1em;">
                    ‚ö†Ô∏è A DECIS√ÉO √â DE VOC√äS. VIDA OU MORTE. ‚ö†Ô∏è
                </p>
            </div>
            
            <div class="nav">
                <button class="nav-btn" onclick="showPanel('connection')">üì° CONEX√ÉO</button>
                <button class="nav-btn" onclick="showPanel('role')">üë• POSTOS</button>
                <button class="nav-btn" onclick="showPanel('game')">üéÆ AN√ÅLISE</button>
                <button class="nav-btn" onclick="showPanel('config')">üîß SISTEMA</button>
                <button class="nav-btn" onclick="showPanel('personality')">ü§ñ IA CONFIG</button>
                <button class="nav-btn" onclick="showPanel('stats')">üìä RELAT√ìRIO</button>
            </div>
        </div>

        <div class="container">
            <!-- Painel de Conex√£o -->
            <div class="panel active" id="connectionPanel">
                <h3>üì° Sistema de Comunica√ß√£o do Bunker</h3>
                
                <div class="connection-status">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <div>
                        <div style="color: #cccccc; font-weight: bold;" id="statusText">üî¥ DESCONECTADO - Estabele√ßa conex√£o para iniciar protocolo</div>
                        <div style="color: #888; font-size: 0.9em;">Sistema de comunica√ß√£o inter-bunkers offline</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <input type="text" id="roomCodeInput" class="config-input" placeholder="C√ìDIGO DE ACESSO DO BUNKER (ex: SALA1234)" maxlength="10">
                    <button onclick="joinRoom()" class="send-btn">üîì CONECTAR AO BUNKER</button>
                </div>
                
                <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                    <button onclick="createRoom()" class="preset-btn" style="flex: 1; background: linear-gradient(135deg, #003300, #006600); border-color: #00ff00;">üèóÔ∏è ESTABELECER NOVO BUNKER</button>
                    <button onclick="leaveRoom()" class="preset-btn" style="flex: 1; background: linear-gradient(135deg, #660000, #330000); border-color: #ff0000;">‚ùå EVACUAR BUNKER</button>
                </div>
                
                <div id="roomInfo" style="display: none;">
                    <div class="qr-container">
                        <h4 style="color: #00ff00; margin-bottom: 15px; font-family: 'Orbitron', monospace;">üì± ACESSO R√ÅPIDO PARA SOBREVIVENTES</h4>
                        <div class="qr-code" id="qrCodeContainer"></div>
                        <div style="color: #00ff00; font-weight: bold; font-size: 1.3em; margin-top: 10px;">
                            C√ìDIGO: <span id="currentRoomCode" style="color: #ffaa00;"></span>
                        </div>
                        <p style="color: #888; margin-top: 10px;">Escaneie o QR Code ou digite o c√≥digo em outro dispositivo</p>
                    </div>
                </div>
                
                <div class="threat-level">
                    <h4>üö® N√çVEL DE AMEA√áA: CR√çTICO</h4>
                    <p style="color: #ffaa00;">Infiltrados detectados na √°rea. Mantenham protocolos de seguran√ßa.</p>
                </div>
            </div>

            <!-- Painel de Pap√©is -->
            <div class="panel" id="rolePanel">
                <h3>üë• Postos de Comando do Bunker</h3>
                <div style="display: flex; gap: 20px; margin-bottom: 25px; flex-wrap: wrap;">
                    <button onclick="selectRole('presenter')" class="role-btn" id="presenterBtn">
                        üé§ COMANDANTE<br>
                        <small>Coordena interrogat√≥rios</small>
                    </button>
                    <button onclick="selectRole('human')" class="role-btn" id="humanBtn">
                        üë§ SOBREVIVENTE<br>
                        <small>Responde aos testes</small>
                    </button>
                    <button onclick="selectRole('observer')" class="role-btn" id="observerBtn">
                        üëÅÔ∏è ANALISTA<br>
                        <small>Observa e decide</small>
                    </button>
                </div>
                
                <div id="roleIndicator" style="background: rgba(0, 0, 0, 0.8); padding: 20px; border-radius: 8px; border: 1px solid #ff0000;">
                    <div style="color: #cccccc;">Selecione seu posto para ativar o protocolo de seguran√ßa</div>
                </div>
            </div>

            <!-- Painel do Jogo -->
            <div class="panel" id="gamePanel">
                <h3>üéÆ Protocolo de An√°lise de Infiltrados</h3>
                
                <div class="threat-level">
                    <h4>‚è±Ô∏è TEMPO LIMITE PARA DECIS√ÉO</h4>
                    <div class="timer" id="tensionTimer">00:00</div>
                    <p style="color: #ffaa00; margin-top: 10px;">Cada segundo conta. As m√°quinas est√£o se aproximando.</p>
                </div>
                
                <div id="questionSection" style="display: none;">
                    <div class="question-container">
                        <h4 style="color: #ff4400; margin-bottom: 15px;">üìù ENVIAR MENSAGEM DE TESTE</h4>
                        <p style="color: #cccccc; margin-bottom: 15px;">Envie uma pergunta para testar se a entidade l√° fora √© humana ou m√°quina:</p>
                        <input type="text" id="questionInput" class="config-input" placeholder="Digite sua pergunta de teste..." maxlength="200">
                        <button onclick="submitQuestion()" class="send-btn">üì° TRANSMITIR PERGUNTA</button>
                    </div>
                </div>

                <div id="answerSection" style="display: none;">
                    <div class="question-container">
                        <h4 style="color: #ff4400; margin-bottom: 15px;">üì® MENSAGEM RECEBIDA</h4>
                        <p style="color: #cccccc; margin-bottom: 15px;">Uma pergunta chegou do exterior. Responda como um humano sobrevivente:</p>
                        <div style="background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border-left: 4px solid #ff4400; margin-bottom: 15px;">
                            <p id="currentQuestionText" style="font-size: 1.2em; color: #ffaa00;">-</p>
                        </div>
                        <textarea id="humanAnswerInput" class="config-input" placeholder="Digite sua resposta humana..." style="min-height: 120px; resize: vertical;"></textarea>
                        <button onclick="submitAnswer()" class="send-btn">üì§ ENVIAR RESPOSTA</button>
                    </div>
                </div>

                <div id="displaySection">
                    <div id="currentQuestion" style="display: none;">
                        <div class="question-container">
                            <h4 style="color: #ff4400; margin-bottom: 15px;">‚ùì PERGUNTA TRANSMITIDA</h4>
                            <div style="background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 5px; border-left: 4px solid #ff4400;">
                                <p id="displayQuestionText" style="font-size: 1.2em; color: #ffaa00;">-</p>
                            </div>
                        </div>

                        <div class="response-container">
                            <div class="response-box" data-label="SINAL A">
                                <h4>üì° TRANSMISS√ÉO A</h4>
                                <div class="response-text" id="response1">Aguardando sinal...</div>
                            </div>
                            <div class="response-box" data-label="SINAL B">
                                <h4>üì° TRANSMISS√ÉO B</h4>
                                <div class="response-text" id="response2">Aguardando sinal...</div>
                            </div>
                        </div>

                        <div class="emergency-alert" style="margin-top: 25px; text-align: center;">
                            <h4 style="color: #ff0000; margin-bottom: 10px;">‚ö†Ô∏è DECIS√ÉO CR√çTICA ‚ö†Ô∏è</h4>
                            <p style="color: #ffaa00;">Analisem as respostas. Uma √© de um humano sobrevivente, a outra de uma m√°quina infiltrada. Escolham com cuidado - suas vidas dependem disso.</p>
                        </div>
                    </div>

                    <div style="margin-top: 25px; display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="clearGame()" class="preset-btn" style="background: linear-gradient(135deg, #660000, #990000); border-color: #ff0000;">üßπ LIMPAR TRANSMISS√ïES</button>
                        <button onclick="nextQuestion()" class="preset-btn" style="background: linear-gradient(135deg, #006600, #009900); border-color: #00ff00;">‚û°Ô∏è PR√ìXIMO TESTE</button>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√£o da API -->
            <div class="panel" id="configPanel">
                <h3>üîß Configura√ß√£o do Sistema de IA</h3>
                
                <div style="margin-bottom: 25px;">
                    <h4 style="color: #cccccc; margin-bottom: 15px;">Escolha o Modelo de IA:</h4>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="preset-btn" onclick="selectProvider('openai')" id="openaiBtn">OpenAI GPT-4o</button>
                        <button class="preset-btn" onclick="selectProvider('groq_llama8b')"